---
// CopyButton.astro
interface Props {
  text: string;
  class?: string;
}

const { text, class: className = '' } = Astro.props;
---

<button
  class={`inline-flex items-center gap-2 px-4 py-0  hover:text-zinc-600  rounded-md text-md font-medium transition-all duration-200 active:scale-95 ${className}`}
  data-text={text}
  aria-label="Copy to clipboard"
>
  <svg class="copy-icon size-4" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
    <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
  </svg>
  <svg class="check-icon size-4 hidden" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="20 6 9 17 4 12"/>
  </svg>
  <span class="copy-text">{text}</span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const buttons = document.querySelectorAll('[data-text]');
    
    buttons.forEach((button) => {
      button.addEventListener('click', async () => {
        const text = button.getAttribute('data-text');
        const copyIcon = button.querySelector('.copy-icon');
        const checkIcon = button.querySelector('.check-icon');
        const copyText = button.querySelector('.copy-text');
        
        if (!text) return;
        
        try {
          await navigator.clipboard.writeText(text);
          
          // Update UI
          copyIcon?.classList.add('hidden');
          checkIcon?.classList.remove('hidden');
          if (copyText) copyText.textContent = text;
          
          // Reset after 2 seconds
          setTimeout(() => {
            copyIcon?.classList.remove('hidden');
            checkIcon?.classList.add('hidden');
            if (copyText) copyText.textContent = text;
          }, 2000);
        } catch (err) {
          console.error('Failed to copy text:', err);
        }
      });
    });
  });
</script>